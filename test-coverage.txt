
 RUN  v3.2.4 /Users/e/dev/github.com/cloudbring/groq-code-cli
      Coverage enabled with v8

 âœ“ src/commands/definitions/reasoning.test.ts (11 tests) 13ms
 â¯ src/core/agent.test.ts (33 tests | 2 failed) 212ms
   âœ“ Agent > Agent.create > should create agent with provided model 4ms
   âœ“ Agent > Agent.create > should use default model from config if available 3ms
   âœ“ Agent > Agent.create > should use provided model if no default in config 3ms
   âœ“ Agent > Agent.create > should accept custom system message 1ms
   âœ“ Agent > API Key Management > should set API key 5ms
   âœ“ Agent > API Key Management > should save API key 1ms
   âœ“ Agent > API Key Management > should clear API key 1ms
   âœ“ Agent > Model Management > should set and get current model 3ms
   âœ“ Agent > Model Management > should update system message when model changes 1ms
   âœ“ Agent > Session Management > should set session auto approve 4ms
   âœ“ Agent > Session Management > should clear history 1ms
   âœ“ Agent > Session Management > should set tool callbacks 4ms
   âœ“ Agent > Session Management > should handle interrupt 1ms
   âœ“ Agent > Chat Functionality > should throw error when no API key available 6ms
   âœ“ Agent > Chat Functionality > should use API key from environment variable 1ms
   âœ“ Agent > Chat Functionality > should use API key from config file when env var not available 1ms
   âœ“ Agent > Chat Functionality > should handle simple chat without tools 1ms
   âœ“ Agent > Chat Functionality > should handle chat with reasoning 0ms
   âœ“ Agent > Chat Functionality > should handle tool calls 9ms
   âœ“ Agent > Chat Functionality > should handle tool call approval 2ms
   âœ“ Agent > Chat Functionality > should handle tool call rejection 2ms
   âœ“ Agent > Chat Functionality > should handle session auto approval 1ms
   âœ“ Agent > Chat Functionality > should handle read-before-edit validation failure 3ms
   Ã— Agent > Chat Functionality > should handle truncated tool arguments 14ms
     â†’ expected "spy" to be called with arguments: [ 'read_file', ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
   âœ“ Agent > Chat Functionality > should handle API errors gracefully 9ms
   âœ“ Agent > Chat Functionality > should handle 401 API errors by throwing immediately 8ms
   âœ“ Agent > Chat Functionality > should handle max iterations with user continuation 3ms
   âœ“ Agent > Chat Functionality > should handle interruption during chat 15ms
   âœ“ Agent > Chat Functionality > should strip repo_browser prefix from tool names 3ms
   Ã— Agent > Error Handling > should handle tool execution errors 42ms
     â†’ expected "spy" to be called with arguments: [ 'read_file', ObjectContaining{â€¦} ][90m

Number of calls: [1m0[22m
[39m
   âœ“ Agent > Error Handling > should handle missing Groq client 1ms
   âœ“ Agent > Debug Functionality > should create agent with debug enabled 1ms
   âœ“ Agent > Debug Functionality > should handle debug logging without errors 51ms
 âœ“ src/ui/hooks/useTokenMetrics.test.ts (33 tests) 308ms
 â¯ src/ui/components/input-overlays/Login.test.tsx (23 tests | 14 failed) 338ms
   âœ“ Login > rendering > should render login form 66ms
   âœ“ Login > rendering > should render cursor 9ms
   Ã— Login > rendering > should render empty API key field initially 31ms
     â†’ expected 'Login with Groq API Key' to contain 'API Key:'
   Ã— Login > input handling > should handle character input 11ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Login > input handling > should handle backspace 94ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Login > input handling > should handle delete key 17ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Login > input handling > should handle enter key with valid input 3ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Login > input handling > should handle enter key with empty input 6ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Login > input handling > should handle escape key 4ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Login > input handling > should handle ctrl+c 3ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Login > input handling > should ignore meta key combinations 17ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Login > input handling > should ignore ctrl key combinations (except ctrl+c) 15ms
     â†’ Cannot read properties of undefined (reading '0')
   âœ“ Login > API key display > should mask API key with asterisks 3ms
   âœ“ Login > API key display > should show ellipsis for long API keys 3ms
   âœ“ Login > API key display > should limit asterisk display to 20 characters 13ms
   Ã— Login > form validation > should call onSubmit with trimmed API key 3ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Login > form validation > should not submit empty or whitespace-only API key 4ms
     â†’ Cannot read properties of undefined (reading '0')
   âœ“ Login > accessibility and usability > should provide clear instructions 3ms
   âœ“ Login > accessibility and usability > should have underlined link to console 5ms
   âœ“ Login > accessibility and usability > should have proper visual hierarchy 6ms
   âœ“ Login > component lifecycle > should initialize with empty API key 5ms
   Ã— Login > component lifecycle > should handle multiple re-renders 10ms
     â†’ expected "spy" to be called at least once
   Ã— Login > component lifecycle > should handle prop changes 5ms
     â†’ expected "spy" to be called at least once
 â¯ src/ui/hooks/useAgent.test.ts (32 tests | 9 failed) 286ms
   âœ“ useAgent > initial state > should initialize with correct default values 55ms
   âœ“ useAgent > initial state > should provide all required methods 10ms
   âœ“ useAgent > sendMessage > should add user message and call agent 5ms
   âœ“ useAgent > sendMessage > should not send message if already processing 4ms
   âœ“ useAgent > sendMessage > should handle chat errors gracefully 20ms
   âœ“ useAgent > sendMessage > should handle API errors with status and error details 3ms
   âœ“ useAgent > sendMessage > should ignore abort errors 3ms
   Ã— useAgent > tool execution callbacks > should handle onThinkingText callback 83ms
     â†’ expected undefined to be defined
   Ã— useAgent > tool execution callbacks > should handle onFinalMessage callback 6ms
     â†’ expected undefined to be defined
   Ã— useAgent > tool execution callbacks > should handle onToolStart callback 13ms
     â†’ expected null not to be null
   Ã— useAgent > tool execution callbacks > should handle onToolEnd callback with success 3ms
     â†’ expected undefined to be 'âœ“ read_file completed successfully' // Object.is equality
   Ã— useAgent > tool execution callbacks > should handle onToolEnd callback with failure 7ms
     â†’ expected undefined to be 'ðŸ”´ read_file failed: File not found' // Object.is equality
   Ã— useAgent > tool execution callbacks > should handle onToolEnd callback with user rejection 3ms
     â†’ expected undefined to be 'ðŸš« delete_file rejected by user' // Object.is equality
   âœ“ useAgent > tool execution callbacks > should handle onApiUsage callback 1ms
   Ã— useAgent > tool execution callbacks > should handle onToolApproval callback 3ms
     â†’ expected null not to be null
   Ã— useAgent > tool execution callbacks > should handle onMaxIterations callback 17ms
     â†’ expected null not to be null
   Ã— useAgent > tool approval > should approve tool execution 6ms
     â†’ result.current.setPendingApproval is not a function
   âœ“ useAgent > tool approval > should reject tool execution 5ms
   âœ“ useAgent > utility functions > should set API key on agent 2ms
   âœ“ useAgent > utility functions > should toggle auto approve 3ms
   âœ“ useAgent > utility functions > should clear history 4ms
   âœ“ useAgent > utility functions > should interrupt request 2ms
   âœ“ useAgent > utility functions > should toggle reasoning display 2ms
   âœ“ useAgent > message management > should add message with generated id and timestamp 2ms
   âœ“ useAgent > message management > should add message with reasoning 3ms
   âœ“ useAgent > message management > should generate unique message ids 3ms
   âœ“ useAgent > tool execution states > should identify tools that need approval 1ms
   âœ“ useAgent > tool execution states > should handle tool execution status changes 2ms
   âœ“ useAgent > edge cases > should handle empty message content 1ms
   âœ“ useAgent > edge cases > should handle multiple rapid message additions 1ms
   âœ“ useAgent > edge cases > should handle callback functions being undefined 3ms
   âœ“ useAgent > edge cases > should handle agent methods throwing errors 1ms
 â¯ src/ui/components/input-overlays/ModelSelector.test.tsx (30 tests | 1 failed) 640ms
   âœ“ ModelSelector > rendering > should render model selector with title 91ms
   âœ“ ModelSelector > rendering > should render all available models 38ms
   âœ“ ModelSelector > rendering > should show pricing information link 39ms
   âœ“ ModelSelector > rendering > should highlight first model by default 6ms
   âœ“ ModelSelector > rendering > should show current model when provided 42ms
   âœ“ ModelSelector > rendering > should select current model when provided 6ms
   âœ“ ModelSelector > rendering > should show descriptions for models that have them 10ms
   âœ“ ModelSelector > navigation > should handle up arrow navigation 8ms
   âœ“ ModelSelector > navigation > should handle down arrow navigation 25ms
   âœ“ ModelSelector > navigation > should not go above first model 5ms
   âœ“ ModelSelector > navigation > should not go below last model 37ms
   âœ“ ModelSelector > navigation > should wrap navigation correctly at boundaries 15ms
   âœ“ ModelSelector > selection and submission > should handle enter key to submit 15ms
   Ã— ModelSelector > selection and submission > should submit correct model when selection changes 34ms
     â†’ expected "spy" to be called with arguments: [ 'openai/gpt-oss-120b' ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[32m-   "openai/gpt-oss-120b",[90m
[31m+   "moonshotai/kimi-k2-instruct",[90m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
   âœ“ ModelSelector > selection and submission > should handle escape key to cancel 2ms
   âœ“ ModelSelector > selection and submission > should handle ctrl+c to cancel 2ms
   âœ“ ModelSelector > model information > should display model descriptions when available 93ms
   âœ“ ModelSelector > model information > should handle models without descriptions 17ms
   âœ“ ModelSelector > model information > should show current model indicator 18ms
   âœ“ ModelSelector > initialization > should initialize with first model when no current model provided 17ms
   âœ“ ModelSelector > initialization > should initialize with current model when provided 16ms
   âœ“ ModelSelector > initialization > should fallback to first model for unknown current model 14ms
   âœ“ ModelSelector > visual feedback > should show selection indicator 3ms
   âœ“ ModelSelector > visual feedback > should have proper visual hierarchy 2ms
   âœ“ ModelSelector > visual feedback > should warn about chat clearing 3ms
   âœ“ ModelSelector > accessibility > should provide clear instructions 5ms
   âœ“ ModelSelector > accessibility > should have underlined pricing link 9ms
   âœ“ ModelSelector > edge cases > should handle empty model list gracefully 37ms
   âœ“ ModelSelector > edge cases > should handle rapid navigation 21ms
   âœ“ ModelSelector > edge cases > should handle multiple renders 9ms
 âœ“ src/ui/components/display/TokenMetrics.test.tsx (12 tests) 227ms
 âœ“ src/tools/tool-schemas.test.ts (44 tests) 12ms
 âœ“ src/utils/file-ops.test.ts (24 tests) 39ms
 âœ“ src/commands/definitions/model.test.ts (8 tests) 8ms
 âœ“ src/commands/index.test.ts (18 tests) 16ms
 âœ“ src/utils/local-settings.test.ts (21 tests) 16ms
 âœ“ src/commands/definitions/clear.test.ts (7 tests) 5ms
 âœ“ src/commands/definitions/help.test.ts (7 tests) 8ms
 âœ“ src/commands/base.test.ts (8 tests) 8ms
 âœ“ src/commands/definitions/login.test.ts (5 tests) 6ms
 âœ“ src/utils/constants.test.ts (6 tests) 2ms
 âœ“ src/utils/markdown.test.ts (22 tests) 8ms
 âœ“ src/tools/validators.test.ts (9 tests) 4ms

 Test Files  5 failed | 15 passed (20)
      Tests  26 failed | 327 passed (353)
   Start at  08:33:20
   Duration  4.73s (transform 3.43s, setup 0ms, collect 8.32s, tests 2.16s, environment 11.10s, prepare 2.69s)

